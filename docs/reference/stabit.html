<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Matching model and selection correction for group formation — stabit • matchingMarkets</title>

<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Matching model and selection correction for group formation — stabit" />

<meta property="og:description" content="The function provides a Gibbs sampler for a structural matching model that 
estimates preferences and corrects for sample selection bias when the selection process 
is a one-sided matching game; that is, group/coalition formation.
The input is individual-level data of all group members from one-sided matching marktes; that is, 
from group/coalition formation games.
In a first step, the function generates a model matrix with characteristics of all feasible 
groups of the same size as the observed groups in the market.
For example, in the stable roommates problem with \(n=4\) students \(\{1,2,3,4\}\) 
sorting into groups of 2, we have \( {4 \choose 2}=6 \) feasible groups: 
(1,2)(3,4) (1,3)(2,4) (1,4)(2,3).
In the group formation problem with \(n=6\) students \(\{1,2,3,4,5,6\}\) 
sorting into groups of 3, we have \( {6 \choose 3} =20\) feasible groups. 
For the same students sorting into groups of sizes 2 and 4, we have \( {6 \choose 2} + 
{6 \choose 4}=30\) feasible groups.
The structural model consists of a selection and an outcome equation. The Selection Equation 
determines which matches are observed (\(D=1\)) and which are not (\(D=0\)).
$$ \begin{array}{lcl}
       D &amp;amp;= &amp;amp; 1[V \in \Gamma] \\
       V &amp;amp;= &amp;amp; W\alpha + \eta
       \end{array}
     $$
Here, \(V\) is a vector of latent valuations of all feasible matches, ie observed and 
unobserved, and \(1[.]\) is the Iverson bracket. 
A match is observed if its match valuation is in the set of valuations \(\Gamma\)
that satisfy the equilibrium condition (see Klein, 2015a). This condition differs for matching
games with transferable and non-transferable utility and can be specified using the method 
argument. 
The match valuation \(V\) is a linear function of \(W\), a matrix of characteristics for 
all feasible groups, and \(\eta\), a vector of random errors. \(\alpha\) is a paramter 
vector to be estimated.
The Outcome Equation determines the outcome for observed matches. The dependent
variable can either be continuous or binary, dependent on the value of the binary
argument. In the binary case, the dependent variable \(R\) is determined by a threshold 
rule for the latent variable \(Y\).
$$ \begin{array}{lcl}
       R &amp;amp;= &amp;amp; 1[Y &amp;gt; c] \\
       Y &amp;amp;= &amp;amp; X\beta + \epsilon
       \end{array}
     $$
Here, \(Y\) is a linear function of \(X\), a matrix of characteristics for observed 
matches, and \(\epsilon\), a vector of random errors. \(\beta\) is a paramter vector to 
be estimated.
The structural model imposes a linear relationship between the error terms of both equations 
as \(\epsilon = \delta\eta + \xi\), where \(\xi\) is a vector of random errors and \(\delta\)
is the covariance paramter to be estimated. If \(\delta\) were zero, the marginal distributions
of \(\epsilon\) and \(\eta\) would be independent and the selection problem would vanish.
That is, the observed outcomes would be a random sample from the population of interest." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">matchingMarkets</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Matching model and selection correction for group formation</h1>
    
    <div class="hidden name"><code>stabit.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function provides a Gibbs sampler for a structural matching model that 
estimates preferences and corrects for sample selection bias when the selection process 
is a one-sided matching game; that is, group/coalition formation.</p>
<p>The input is individual-level data of all group members from one-sided matching marktes; that is, 
from group/coalition formation games.</p>
<p>In a first step, the function generates a model matrix with characteristics of <em>all feasible</em> 
groups of the same size as the observed groups in the market.</p>
<p>For example, in the stable roommates problem with \(n=4\) students \(\{1,2,3,4\}\) 
sorting into groups of 2, we have \( {4 \choose 2}=6 \) feasible groups: 
(1,2)(3,4) (1,3)(2,4) (1,4)(2,3).</p>
<p>In the group formation problem with \(n=6\) students \(\{1,2,3,4,5,6\}\) 
sorting into groups of 3, we have \( {6 \choose 3} =20\) feasible groups. 
For the same students sorting into groups of sizes 2 and 4, we have \( {6 \choose 2} + 
{6 \choose 4}=30\) feasible groups.</p>
<p>The structural model consists of a selection and an outcome equation. The <em>Selection Equation</em> 
determines which matches are observed (\(D=1\)) and which are not (\(D=0\)).
$$ \begin{array}{lcl}
       D &amp;= &amp; 1[V \in \Gamma] \\
       V &amp;= &amp; W\alpha + \eta
       \end{array}
     $$
Here, \(V\) is a vector of latent valuations of <em>all feasible</em> matches, ie observed and 
unobserved, and \(1[.]\) is the Iverson bracket. 
A match is observed if its match valuation is in the set of valuations \(\Gamma\)
that satisfy the equilibrium condition (see Klein, 2015a). This condition differs for matching
games with transferable and non-transferable utility and can be specified using the <code>method</code> 
argument. 
The match valuation \(V\) is a linear function of \(W\), a matrix of characteristics for 
<em>all feasible</em> groups, and \(\eta\), a vector of random errors. \(\alpha\) is a paramter 
vector to be estimated.</p>
<p>The <em>Outcome Equation</em> determines the outcome for <em>observed</em> matches. The dependent
variable can either be continuous or binary, dependent on the value of the <code>binary</code>
argument. In the binary case, the dependent variable \(R\) is determined by a threshold 
rule for the latent variable \(Y\).
$$ \begin{array}{lcl}
       R &amp;= &amp; 1[Y &gt; c] \\
       Y &amp;= &amp; X\beta + \epsilon
       \end{array}
     $$
Here, \(Y\) is a linear function of \(X\), a matrix of characteristics for <em>observed</em> 
matches, and \(\epsilon\), a vector of random errors. \(\beta\) is a paramter vector to 
be estimated.</p>
<p>The structural model imposes a linear relationship between the error terms of both equations 
as \(\epsilon = \delta\eta + \xi\), where \(\xi\) is a vector of random errors and \(\delta\)
is the covariance paramter to be estimated. If \(\delta\) were zero, the marginal distributions
of \(\epsilon\) and \(\eta\) would be independent and the selection problem would vanish.
That is, the observed outcomes would be a random sample from the population of interest.</p>
    
    </div>

    <pre class="usage"><span class='fu'>stabit</span>(<span class='no'>x</span>, <span class='kw'>m.id</span> <span class='kw'>=</span> <span class='st'>"m.id"</span>, <span class='kw'>g.id</span> <span class='kw'>=</span> <span class='st'>"g.id"</span>, <span class='kw'>R</span> <span class='kw'>=</span> <span class='st'>"R"</span>, <span class='kw'>selection</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>simulation</span> <span class='kw'>=</span> <span class='st'>"none"</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>123</span>, <span class='kw'>max.combs</span> <span class='kw'>=</span> <span class='fl'>Inf</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"NTU"</span>, <span class='kw'>binary</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>offsetOut</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>offsetSel</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>marketFE</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>censored</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>gPrior</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>dropOnes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>interOut</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>interSel</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>standardize</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>niter</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>data frame with individual-level characteristics of all group members including
market- and group-identifiers.</p></td>
    </tr>
    <tr>
      <th>m.id</th>
      <td><p>character string giving the name of the market identifier variable. Defaults to <code>"m.id"</code>.</p></td>
    </tr>
    <tr>
      <th>g.id</th>
      <td><p>character string giving the name of the group identifier variable. Defaults to <code>"g.id"</code>.</p></td>
    </tr>
    <tr>
      <th>R</th>
      <td><p>dependent variable in outcome equation. Defaults to <code>"R"</code>.</p></td>
    </tr>
    <tr>
      <th>selection</th>
      <td><p>list containing variables and pertaining operators in the selection equation. The format is 
<code>operation = "variable"</code>. See the Details and Examples sections.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>list containing variables and pertaining operators in the outcome equation. The format is 
<code>operation = "variable"</code>. See the Details and Examples sections.</p></td>
    </tr>
    <tr>
      <th>simulation</th>
      <td><p>should the values of dependent variables in selection and outcome equations be simulated? Options are <code>"none"</code> for no simulation, <code>"NTU"</code> for non-transferable utility matching, <code>"TU"</code> for transferable utility or <code>"random"</code> for random matching of individuals to groups. Simulation settings are (i) all model coefficients set to <code>alpha=beta=1</code>; (ii) covariance between error terms <code>delta=0.5</code>; (iii) error terms <code>eta</code> and <code>xi</code> are draws from a standard normal distribution.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>integer setting the state for random number generation if <code>simulation=TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>max.combs</th>
      <td><p>integer (divisible by two) giving the maximum number of feasible groups to be used for generating group-level characteristics.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>estimation method to be used. Either <code>"NTU"</code> or <code>"TU"</code> for selection correction using non-transferable or transferable utility matching as selection rule; <code>"outcome"</code> for estimation of the outcome equation only; or <code>"model.frame"</code> for no estimation.</p></td>
    </tr>
    <tr>
      <th>binary</th>
      <td><p>logical: if <code>TRUE</code> outcome variable is taken to be binary; if <code>FALSE</code> outcome variable is taken to be continuous.</p></td>
    </tr>
    <tr>
      <th>offsetOut</th>
      <td><p>vector of integers indicating the indices of columns in <code>X</code> for which coefficients should be forced to 1. Use 0 for none.</p></td>
    </tr>
    <tr>
      <th>offsetSel</th>
      <td><p>vector of integers indicating the indices of columns in <code>W</code> for which coefficients should be forced to 1. Use 0 for none.</p></td>
    </tr>
    <tr>
      <th>marketFE</th>
      <td><p>logical: if <code>TRUE</code> market-level fixed effects are used in outcome equation; if <code>FALSE</code> no market fixed effects are used.</p></td>
    </tr>
    <tr>
      <th>censored</th>
      <td><p>draws of the <code>delta</code> parameter that estimates the covariation between the error terms in selection and outcome equation are 0:not censored, 1:censored from below, 2:censored from above.</p></td>
    </tr>
    <tr>
      <th>gPrior</th>
      <td><p>logical: if <code>TRUE</code> the g-prior (Zellner, 1986) is used for the variance-covariance matrix.</p></td>
    </tr>
    <tr>
      <th>dropOnes</th>
      <td><p>logical: if <code>TRUE</code> one-group-markets are exluded from estimation.</p></td>
    </tr>
    <tr>
      <th>interOut</th>
      <td><p>two-colum matrix indicating the indices of columns in <code>X</code> that should be interacted in estimation. Use 0 for none.</p></td>
    </tr>
    <tr>
      <th>interSel</th>
      <td><p>two-colum matrix indicating the indices of columns in <code>W</code> that should be interacted in estimation. Use 0 for none.</p></td>
    </tr>
    <tr>
      <th>standardize</th>
      <td><p>numeric: if <code>standardize&gt;0</code> the independent variables will be standardized by dividing by <code>standardize</code> times their standard deviation. Defaults to no standardization <code>standardize=0</code>.</p></td>
    </tr>
    <tr>
      <th>niter</th>
      <td><p>number of iterations to use for the Gibbs sampler.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Operators for variable transformations in <code>selection</code> and <code>outcome</code> arguments.</p><dl class='dl-horizontal'>
<dt><code>add</code></dt><dd><p>sum over all group members and divide by group size.</p></dd>
<dt><code>int</code></dt><dd><p>sum over all possible two-way interactions \(x*y\) of group members and divide by the number of those, given by <code>choose(n,2)</code>.</p></dd>
<dt><code>ieq</code></dt><dd><p>sum over all possible two-way equality assertions \(1[x=y]\) and divide by the number of those.</p></dd>
<dt><code>ive</code></dt><dd><p>sum over all possible two-way interactions of vectors of variables of group members and divide by number of those.</p></dd>
<dt><code>inv</code></dt><dd><p>...</p></dd>
<dt><code>dst</code></dt><dd><p>sum over all possible two-way distances between players and divide by number of those, where distance is defined as \(e^{-|x-y|}\).</p></dd>
</dl>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Klein, T. (2015a). <a href='https://ideas.repec.org/p/cam/camdae/1521.html'>Does Anti-Diversification Pay? A One-Sided Matching Model of Microcredit</a>.
<em>Cambridge Working Papers in Economics</em>, #1521.</p>
<p>Zellner, A. (1986). <em>On assessing prior distributions and Bayesian regression analysis with g-prior distributions</em>, 
volume 6, pages 233--243. North-Holland, Amsterdam.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>## --- SIMULATED EXAMPLE ---</span>

<span class='co'>## 1. Simulate one-sided matching data for 200 markets (m=200) with 2 groups</span>
<span class='co'>##    per market (gpm=2) and 5 individuals per group (ind=5). True parameters </span>
<span class='co'>##    in selection equation is wst=1, in outcome equation wst=0. </span>

<span class='co'>## 1-a. Simulate individual-level, independent variables</span>
 <span class='no'>idata</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='stabsim.html'>stabsim</a></span>(<span class='kw'>m</span><span class='kw'>=</span><span class='fl'>200</span>, <span class='kw'>ind</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>seed</span><span class='kw'>=</span><span class='fl'>123</span>, <span class='kw'>gpm</span><span class='kw'>=</span><span class='fl'>2</span>)
 <span class='fu'>head</span>(<span class='no'>idata</span>)</div><div class='output co'>#&gt;   m.id g.id         wst  R
#&gt; 1    1    1 -0.56047565 NA
#&gt; 2    1    1 -0.23017749 NA
#&gt; 3    1    1  1.55870831 NA
#&gt; 4    1    1  0.07050839 NA
#&gt; 5    1    1  0.12928774 NA
#&gt; 6    1    2  1.71506499 NA</div><div class='input'>
<span class='co'>## 1-b. Simulate group-level variables </span>
 <span class='no'>mdata</span> <span class='kw'>&lt;-</span> <span class='fu'>stabit</span>(<span class='kw'>x</span><span class='kw'>=</span><span class='no'>idata</span>, <span class='kw'>simulation</span><span class='kw'>=</span><span class='st'>"NTU"</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"model.frame"</span>,
 <span class='kw'>selection</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>add</span><span class='kw'>=</span><span class='st'>"wst"</span>), <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>add</span><span class='kw'>=</span><span class='st'>"wst"</span>), <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; Generating group-level data for 200 markets... </div><div class='input'> <span class='fu'>head</span>(<span class='no'>mdata</span>$<span class='no'>OUT</span>)</div><div class='output co'>#&gt;   m.id g.id intercept    wst.add          R         xi    epsilon
#&gt; 1    1    1         1  0.3698086  1.5670690 -0.8497043  1.5670690
#&gt; 2    1    2         1 -0.2205573 -2.4953827 -1.1373036 -2.4953827
#&gt; 3    2    1         1  0.7198747  1.3680982 -1.1198997  1.3680982
#&gt; 4    2    2         1 -0.3026307  0.3707344 -0.7822018  0.3707344
#&gt; 5    3    1         1 -0.3271234  3.0184259 -0.3719449  3.0184259
#&gt; 6    3    2         1 -0.5219943 -0.1015002 -0.6527744 -0.1015002</div><div class='input'> <span class='fu'>head</span>(<span class='no'>mdata</span>$<span class='no'>SEL</span>)</div><div class='output co'>#&gt;   m.id g.id reg.id    wst.add D          V         eta
#&gt; 1    1    1      2  0.3698086 1  2.7865819  2.41677335
#&gt; 2    1    2      1 -0.2205573 1 -1.5786364 -1.35807906
#&gt; 3    1    3    128  0.1935703 0 -0.1503470 -0.34391723
#&gt; 4    1    4    129  0.2221432 0  1.8206520  1.59850877
#&gt; 5    1    5    130  0.3377849 0  0.2492198 -0.08856511
#&gt; 6    1    6    131  0.3860231 0  1.4668226  1.08079950</div><div class='input'>

<span class='co'>## 2. Bias from sorting</span>

<span class='co'>## 2-a. Naive OLS estimation</span>
 <span class='fu'>lm</span>(<span class='no'>R</span> ~ <span class='no'>wst.add</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>mdata</span>$<span class='no'>OUT</span>)$<span class='no'>coefficients</span></div><div class='output co'>#&gt; (Intercept)     wst.add 
#&gt;    1.321692    1.281722 </div><div class='input'>
<span class='co'>## 2-b. epsilon is correlated with independent variables</span>
 <span class='fu'>with</span>(<span class='no'>mdata</span>$<span class='no'>OUT</span>, <span class='fu'>cor</span>(<span class='no'>epsilon</span>, <span class='no'>wst.add</span>))</div><div class='output co'>#&gt; [1] 0.3650137</div><div class='input'>
<span class='co'>## 2-c. but xi is uncorrelated with independent variables</span>
 <span class='fu'>with</span>(<span class='no'>mdata</span>$<span class='no'>OUT</span>, <span class='fu'>cor</span>(<span class='no'>xi</span>, <span class='no'>wst.add</span>))</div><div class='output co'>#&gt; [1] 0.001335074</div><div class='input'>
<span class='co'>## 3. Correction of sorting bias when valuations V are observed</span>

<span class='co'>## 3-a. 1st stage: obtain fitted value for eta</span>
<span class='no'>lm.sel</span> <span class='kw'>&lt;-</span> <span class='fu'>lm</span>(<span class='no'>V</span> ~ -<span class='fl'>1</span> + <span class='no'>wst.add</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>mdata</span>$<span class='no'>SEL</span>)
<span class='no'>lm.sel</span>$<span class='no'>coefficients</span></div><div class='output co'>#&gt;  wst.add 
#&gt; 1.006372 </div><div class='input'>
<span class='no'>eta</span> <span class='kw'>&lt;-</span> <span class='no'>lm.sel</span>$<span class='no'>resid</span>[<span class='no'>mdata</span>$<span class='no'>SEL</span>$<span class='no'>D</span><span class='kw'>==</span><span class='fl'>1</span>]

<span class='co'>## 3-b. 2nd stage: control for eta</span>
 <span class='fu'>lm</span>(<span class='no'>R</span> ~ <span class='no'>wst.add</span> + <span class='no'>eta</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>mdata</span>$<span class='no'>OUT</span>)$<span class='no'>coefficients</span></div><div class='output co'>#&gt; (Intercept)     wst.add         eta 
#&gt;  0.09072970  0.09468869  0.94626877 </div><div class='input'>

<span class='co'>## 4. Run Gibbs sampler</span>
 <span class='no'>fit1</span> <span class='kw'>&lt;-</span> <span class='fu'>stabit</span>(<span class='kw'>x</span><span class='kw'>=</span><span class='no'>idata</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"NTU"</span>, <span class='kw'>simulation</span><span class='kw'>=</span><span class='st'>"NTU"</span>, <span class='kw'>censored</span><span class='kw'>=</span><span class='fl'>1</span>,
                <span class='kw'>selection</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>add</span><span class='kw'>=</span><span class='st'>"wst"</span>), <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>add</span><span class='kw'>=</span><span class='st'>"wst"</span>),
                <span class='kw'>niter</span><span class='kw'>=</span><span class='fl'>2000</span>, <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; Generating group-level data for 200 markets... 
#&gt; Drawing 2000 MCMC samples...</div><div class='input'>

<span class='co'>## 5. Coefficient table</span>
 <span class='fu'>summary</span>(<span class='no'>fit1</span>)</div><div class='output co'>#&gt; 
#&gt; Coefficients for multi-index sample selection model.
#&gt; Method: Klein (2015), one-sided matching market
#&gt; 
#&gt; Call:
#&gt; stabit(x = idata, selection = list(add = "wst"), outcome = list(add = "wst"), 
#&gt;     simulation = "NTU", method = "NTU", censored = 1, niter = 2000, 
#&gt;     verbose = FALSE)
#&gt; 
#&gt; Selection equation:
#&gt;         Estimate  StdErr t.value  p.value   
#&gt; wst.add  1.15188 0.41565  2.7713 0.005846 **
#&gt; 
#&gt; Outcome equation:
#&gt;             Estimate     StdErr t.value p.value   
#&gt; intercept  0.0733179  0.3871956  0.1894 0.84991   
#&gt; wst.add   -0.0083934  0.4812529 -0.0174 0.98609   
#&gt; delta      0.9632351  0.2999799  3.2110 0.00143 **
#&gt; ---
#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</div><div class='input'>

<span class='co'>## 6. Plot MCMC draws for coefficients</span>
 <span class='fu'>plot</span>(<span class='no'>fit1</span>)</div><div class='img'><img src='stabit-1.png' alt='' width='700' height='433' /></div><div class='img'><img src='stabit-2.png' alt='' width='700' height='433' /></div><div class='input'>

## --- REPLICATION, Klein (2015a) ---
</div><span class='co'># NOT RUN {</span>
<span class='co'>## 1. Load data </span>
 <span class='fu'>data</span>(<span class='no'>baac00</span>); <span class='fu'>head</span>(<span class='no'>baac00</span>)

<span class='co'>## 2. Run Gibbs sampler</span>
 <span class='no'>klein15a</span> <span class='kw'>&lt;-</span> <span class='fu'>stabit</span>(<span class='kw'>x</span><span class='kw'>=</span><span class='no'>baac00</span>, <span class='kw'>selection</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>inv</span><span class='kw'>=</span><span class='st'>"pi"</span>,<span class='kw'>ieq</span><span class='kw'>=</span><span class='st'>"wst"</span>),
        <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>add</span><span class='kw'>=</span><span class='st'>"pi"</span>,<span class='kw'>inv</span><span class='kw'>=</span><span class='st'>"pi"</span>,<span class='kw'>ieq</span><span class='kw'>=</span><span class='st'>"wst"</span>,
        <span class='kw'>add</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"loan_size"</span>,<span class='st'>"loan_size2"</span>,<span class='st'>"lngroup_agei"</span>)), <span class='kw'>offsetOut</span><span class='kw'>=</span><span class='fl'>1</span>,
        <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"NTU"</span>, <span class='kw'>binary</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>gPrior</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>marketFE</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>niter</span><span class='kw'>=</span><span class='fl'>800000</span>)

<span class='co'>## 3. Marginal effects</span>
 <span class='fu'>summary</span>(<span class='no'>klein15a</span>, <span class='kw'>mfx</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'>## 4. Plot MCMC draws for coefficients</span>
 <span class='fu'>plot</span>(<span class='no'>klein15a</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Thilo Klein

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Thilo Klein.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

